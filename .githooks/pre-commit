#!/bin/bash
set -e

echo "ğŸ” TÃ¬m cÃ¡c file schema Zod thay Ä‘á»•i trong thÆ° má»¥c /zod..."

# Láº¥y danh sÃ¡ch cÃ¡c file JS staged náº±m trong thÆ° má»¥c /zod/
FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '^zod/.*\.js$' || true)

for FILE in $FILES; do
  echo "ğŸ›  Generating JSON Schema tá»«: $FILE"
  
  OUT_FILE="json-schema/${FILE%.js}.json"

  # Táº¡o thÆ° má»¥c náº¿u chÆ°a cÃ³
  mkdir -p "$(dirname "$OUT_FILE")"

  # Generate JSON Schema vÃ  ghi ra file
  ./libs/bun ./generate.sh "$FILE" > "$OUT_FILE"

  # Add file Ä‘Ã£ generate vÃ o commit
  git add "$OUT_FILE"
done

echo "âœ… Xong. ÄÃ£ generate + add láº¡i cÃ¡c schema thay Ä‘á»•i."
