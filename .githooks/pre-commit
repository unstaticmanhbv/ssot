#!/bin/bash
set -e

echo "ğŸ” Kiá»ƒm tra cÃ¡c file Zod schema vá»«a staged..."

# Láº¥y danh sÃ¡ch file .js trong thÆ° má»¥c zod/ Ä‘Ã£ staged
FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '^zod/.*\.js$' || true)

for FILE in $FILES; do
  echo "ğŸ›  Generating from: $FILE"

  # Generate schema
  ./generate.sh "$FILE"

  # TÃ¬m path tÆ°Æ¡ng á»©ng Ä‘á»ƒ git add (báº±ng láº¡i logic trong generate.sh)
  RELATIVE_PATH="${FILE#zod/}"
  JSON_PATH="json-schema/${RELATIVE_PATH%.js}.json"

  # Add file json vÃ o commit
  git add "$JSON_PATH"
done

echo "âœ… Xong. ÄÃ£ generate vÃ  git add láº¡i cÃ¡c schema bá»‹ thay Ä‘á»•i."
