#!/bin/bash
set -e

echo "üîç Ki·ªÉm tra c√°c file Zod schema v·ª´a staged..."

# L·∫•y danh s√°ch file .js trong th∆∞ m·ª•c zod/ ƒë√£ staged
FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '^zod/.*\.js$' || true)

COUNT=0

for FILE in $FILES; do
  echo "üõ† Generating from: $FILE"

  # Generate schema
  ./generate.sh "$FILE"

  # T√¨m path t∆∞∆°ng ·ª©ng ƒë·ªÉ git add (b·∫±ng l·∫°i logic trong generate.sh)
  RELATIVE_PATH="${FILE#zod/}"
  JSON_PATH="json-schema/${RELATIVE_PATH%.js}.json"

  # Add file json v√†o commit
  git add "$JSON_PATH"

  COUNT=$((COUNT + 1))
done

echo "‚úÖ Done. Generated $COUNT files."
